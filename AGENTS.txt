SDOC - Simple/Smart Documentation Format
=========================================

A plain text documentation format with explicit brace scoping.
This repo contains the format specification, a JavaScript parser/renderer,
and a VSCode extension for live preview.


PROJECT STRUCTURE
-----------------

spec/               Specification and governance (not user-facing)
  requirements.sdoc   Why SDOC exists, abstract requirements (R1-R10), concrete requirements (C1-C5)
  specification.sdoc  The formal v0.1 spec, written in SDOC format
  suggestions.sdoc    Proposed features (S1-S9) with priority and rationale
  status.sdoc         What's done, what's in progress, what's next

examples/           Example and reference files
  example.sdoc        Quick reference showing all SDOC features
  sdoc.config.json    Sample config (style, header, footer)
  sdoc.template.css   Default theme stylesheet
  example-overrides.css  Example CSS overrides

docs/               User-facing documentation
  guide/              Getting started, setup
  reference/          API and CLI reference
  tutorials/          Step-by-step tutorials
  index.sdoc          Docs landing page

src/                Source code
  sdoc.js             Parser and HTML renderer (~1500 lines)
  extension.js        VSCode extension (~900 lines)
  site-template/      Shared viewer templates (index.html, viewer.css)

test/               Test files
  test-all.js         Comprehensive test suite (node test/test-all.js)
  test-knr.js         K&R brace placement tests (node test/test-knr.js)
  test-inline-blocks.sdoc  Inline block parsing fixture
  test-edge-cases.sdoc     Edge case parsing fixture
tools/              Build tools (static site generator)
  build_site.py       CLI to build a self-contained static SDOC viewer site
dist/               Build output (gitignored)
_sdoc_site/         Generated static site output (gitignored)


BEFORE MAKING CHANGES
---------------------

Read spec/status.sdoc first. It has the current task list.

If changing the parser or renderer, read spec/specification.sdoc.
If adding features, read spec/requirements.sdoc and spec/suggestions.sdoc.

The requirements document defines stable goals (R1-R10) that all changes
should be evaluated against. Don't break them.


CODING CONVENTIONS
------------------

JavaScript:
- Vanilla JS, no transpilation, no TypeScript
- CommonJS require/module.exports (this is a VSCode extension)
- No runtime dependencies. The parser must stay dependency-free.
- const by default, let when reassignment is needed, never var
- Semicolons required
- Double quotes for strings
- Functions over classes unless state encapsulation is clearly needed
- Error collection pattern: accumulate errors, don't throw (see LineCursor)

Parser architecture:
- Line-based parsing. Command tokens only at start of line.
- AST must be format-neutral (see C2 in requirements.sdoc)
- Parsing and rendering are separate concerns. Don't mix them.
- parseSdoc() returns { nodes, errors }. Renderers consume nodes.

Testing:
- No test framework. Tests are plain Node scripts with assert helpers.
- Run all tests: node test/test-all.js && node test/test-knr.js
- test-all.js: comprehensive suite (78 tests) covering all parser and renderer features
- test-knr.js: focused K&R brace style tests (24 tests)
- Tests exit non-zero on failure.
- When changing the parser, run the tests and verify 0 failures before committing.

Building the extension:
- npm install (dev dependencies only, for vsce)
- npm run package (or: npx vsce package --out dist/ --allow-missing-repository)
- Produces dist/sdoc-<version>.vsix
- Install: code --install-extension dist/sdoc-<version>.vsix

SDOC format:
- The project docs themselves are written in SDOC
- The spec is in spec/specification.sdoc
- examples/example.sdoc is a quick reference


FILE CONVENTIONS
----------------

- .sdoc files: SDOC format documents
- .gitignore covers: node_modules/, dist/, _sdoc_site/, .DS_Store
- No build artifacts in the repo (dist/, _sdoc_site/ are gitignored)
- User docs go in docs/, spec and governance docs go in spec/


STATIC SITE BUILDER
-------------------

Two ways to build a self-contained static SDOC viewer site:

Python CLI (tools/build_site.py):
  python tools/build_site.py                        # build current dir → _sdoc_site/
  python tools/build_site.py docs/                  # build docs/ → docs/_sdoc_site/
  python tools/build_site.py docs/ -o out/          # build docs/ → out/

VSCode command:
  "SDOC: Build Site" from the command palette builds all .sdoc files
  in the workspace into _sdoc_site/ at the workspace root.

Both produce the same output:
  _sdoc_site/
    index.html      ← viewer shell
    viewer.css      ← viewer styles
    sdoc-web.js     ← parser/renderer for browser
    sdoc-data.js    ← bundled document content + configs
